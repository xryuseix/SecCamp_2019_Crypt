# Cubing暗号の利用モード

## 概要

* 平文ブロック長：45byte
* 暗号文ブロック長：54byte
* 鍵長：可変
(編集中)

## 図

(編集中)

## 流れ

1. 平文をブロックに分ける
2. 必要があればパディングを用意する
3. 全てのブロックに対し、エンコードを行う
4. ブロックごとに暗号化を行う
5. ブロックをシャッフルする(「リプレイ攻撃対策」参照)

(編集中)

## パディング

平文ブロックが45byteに満たない場合、特定の文字を入れる。推奨はアスタリスク( * )。

## エンコード

本節では以下の記号を用いる

$B_i$：ブロックの$i$ Byte目の文字
$BR_i$：平文の$i$ブロック目
$toas(C)$：特定の文字$C$のASCIIコードにおける番号
$fras(N)$：特定の数字$N$のASCIIコードにおける文字
$floor(F)$：実数$F$の切り捨て

この時、

```math
B_{45+i}=fras(\{(\Sigma_{j=9*(i-1)+1}^{9*i}{toas(B_j)})\bmod26\}+97)\\

B_{50}=toas('A')+floor(i/26)\\
B_{51}=\\

```

（上に以下の内容を入れる）

```cpp
if(i < 26*52) {
        cubing[i][50] = 'A' + (i/26);
    } else {
        cubing[i][50] = 'a' + (i/26);
    }

    if(i < 25) {
        cubing[i][51] = 'A' + (i%26);
    } else {
        cubing[i][51] = 'a' + (i%26);
    }
```

である。

(編集中)

## リプレイ攻撃対策

(編集中)

### ブロックが$52^2$以上ある時の処理
